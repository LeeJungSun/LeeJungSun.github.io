var memXpos=0;var memYpos=0;$.get('js/data/estateInfo_member.json',function(a){$.map(a,function(b,c){memXpos=a[0].member_xpos,memYpos=a[0].member_ypos,$('.memXpos').val(memXpos),$('.memYpos').val(memYpos);});}).done(function(){function a2(c){var b=new daum.maps.Marker({position:c,zIndex:1,image:X});b.setMap(a),v.push(b);}function I(b){for(var a=0;a<v.length;a++)v[a].setMap(b);}function J(b){I(null),a.setCenter(b),a2(b);}function a1(c){var b;c==='roadmap'?b=daum.maps.MapTypeId.ROADMAP:c==='traffic'?b=daum.maps.MapTypeId.TRAFFIC:c==='roadview'?b=daum.maps.MapTypeId.ROADVIEW:c==='skyview'?b=daum.maps.MapTypeId.SKYVIEW:c==='terrain'?b=daum.maps.MapTypeId.TERRAIN:c==='use_district'&&(b=daum.maps.MapTypeId.USE_DISTRICT),D&&a.removeOverlayMapTypeId(D),a.addOverlayMapTypeId(b),D=b;}function ac(){a.setLevel(a.getLevel()-1);}function ab(){a.setLevel(a.getLevel()+1);}function L(a){a5.getNearestPanoId(a,50,function(b){b===null?a0(!0,a):(a0(!1,a),t.setPanoId(b,a));});}function a0(b,c){b?(w.className='',a.relayout()):w.className.indexOf('view_roadview')===-1&&(w.className='view_roadview',a.relayout());}function H(b){b?(m=!0,a.addOverlayMapTypeId(daum.maps.MapTypeId.ROADVIEW)):(m=!1,a.removeOverlayMapTypeId(daum.maps.MapTypeId.ROADVIEW),c.setMap(null));}function aa(){var b=document.getElementById('roadviewControl');b.className.indexOf('active')===-1?(b.className='btn_loadview on active',H(!0),$('#mapCtrl.view_roadview #mapWrapper').css('width','75%'),$('#rvWrapper').show()):(b.className='btn_loadview',H(!1),$('#mapCtrl.view_roadview #mapWrapper').css('width','100%'),$('#rvWrapper').hide(),c.setMap(null),a.setCenter(a.getCenter()));}function G(){d&&(d.setMap(null),d=null);}function K(b,c){f?(f.setPosition(c),f.setContent(b)):f=new daum.maps.CustomOverlay({map:a,content:b,position:c,xAnchor:0,yAnchor:0,zIndex:3});}function E(){f&&(f.setMap(null),f=null);}function Z(e,f){var c=new daum.maps.CustomOverlay({content:'<span class="dot"></span>',position:e,zIndex:1});if(c.setMap(a),f>0){var d=new daum.maps.CustomOverlay({content:'<div class="dotOverlay">거리 <span class="number">'+f+'</span>m</div>',position:e,yAnchor:1,zIndex:2});d.setMap(a);}b.push({circle:c,distance:d});}function B(){var a;for(a=0;a<b.length;a++)b[a].circle&&b[a].circle.setMap(null),b[a].distance&&b[a].distance.setMap(null);b=[];}function a9(d){var b=d/67|0;var e='',f='';b>60&&(e='<span class="number">'+Math.floor(b/60)+'</span>시간 '),f='<span class="number">'+b%60+'</span>분';var c=d/227|0;var g='',h='';c>60&&(g='<span class="number">'+Math.floor(c/60)+'</span>시간 '),h='<span class="number">'+c%60+'</span>분';var a='<ul class="dotOverlay distanceInfo">';return a+='    <li>',a+='        <span class="label">총거리</span><span class="number">'+d+'</span>m',a+='    </li>',a+='    <li>',a+='        <span class="label">도보</span>'+e+f,a+='    </li>',a+='    <li>',a+='        <span class="label">자전거</span>'+g+h,a+='    </li>',a+='</ul>',a;}var z=Number($('.memXpos').val());var A=Number($('.memYpos').val());var a=new daum.maps.Map(document.getElementById('map'),{center:new daum.maps.LatLng(A,z),level:3});var v=[];var M='img/marker/marker01_on.png',N='img/marker/marker02_on.png',O=new daum.maps.Size(38,52),P=new daum.maps.Size(38,52),R={offset:new daum.maps.Point(27,53)},S={offset:new daum.maps.Point(20,75)},V=new daum.maps.MarkerImage(M,O,R),X=new daum.maps.MarkerImage(N,P,S);var c=new daum.maps.Marker({position:new daum.maps.LatLng(A,z),zIndex:3,image:V,clickable:!0});c.setMap(a);var _='<dl class="ly_marker_info">   <dt class="blind">중개소명</dt>   <dd class="marker_tit">골든키 공인중개소</dd>   <dt class="blind">주소</dt>   <dd class="marker_info address">경기도 용인시 기흥구 동백중앙로 175 우함빌딩</dd>   <dt class="blind">전화번호</dt>   <dd class="marker_info tel">031-639-9000</dd></dl>',u=!1;var x=new daum.maps.CustomOverlay({content:_,map:a,position:c.getPosition(),zIndex:2});x.setMap(null),daum.maps.event.addListener(c,'click',function(){u==0?(x.setMap(a),u=!0):(x.setMap(null),u=!1);});var n='40px';var k='60px';var r='80px';var q='100px';var e=new daum.maps.MarkerClusterer({map:a,averageCenter:!0,minLevel:1,disableClickZoom:!0,calculator:[10,30,50,80],styles:[{display:'flex',alignItems:'center',justifyContent:'center',width:n,height:n,border:'1px solid #3a78bd',background:'#3884dc',borderRadius:'50%',color:'#fff',textAlign:'center',fontWeight:'bold',opacity:0.85,transform:'scale(1)',transition:'all .05s ease-out'},{display:'flex',alignItems:'center',justifyContent:'center',width:k,height:k,border:'1px solid #3a78bd',background:'#3884dc',borderRadius:'50%',color:'#fff',textAlign:'center',fontWeight:'bold',opacity:0.85,transform:'scale(1)',transition:'all .05s ease-out'},{display:'flex',alignItems:'center',justifyContent:'center',width:r,height:r,border:'1px solid #3a78bd',background:'#3884dc',borderRadius:'50%',color:'#fff',textAlign:'center',fontWeight:'bold',opacity:0.85,transform:'scale(1)',transition:'all .05s ease-out'},{display:'flex',alignItems:'center',justifyContent:'center',width:q,height:q,border:'1px solid #3a78bd',background:'#3884dc',borderRadius:'50%',color:'#fff',textAlign:'center',fontWeight:'bold',opacity:0.85,transform:'scale(1)',transition:'all .05s ease-out'}]});e.setMinClusterSize(1);var i={};var F={};var l=[];var y=[];var Q=[];var p=[];var s=function(a){return a=String(a),a.replace(/(\d)(?=(?:\d{3})+(?!\d))/g,'$1,');};var T=function(){var b=$('.unit');for(var a=0;a<b.length;a++){if(b.eq(a).text().length>4){var c=Math.floor(Number(b.eq(a).text())/10000);var d=Number(b.eq(a).text())%10000;d==0?b.eq(a).text(s(c+'억')):b.eq(a).text(String(c)+'억'+s(d));}b.eq(a).text(s(b.eq(a).text()));}};var U=function(){var b=$('.tag_type span');for(var a=0;a<b.length;a++)b.eq(a).text(b.eq(a).text().substr(2).replace(/\-/g,'.'));};var g=function(b,c,g,h){var a=$.ajax({url:'js/hbs/'+c+'.hbs'});var d=function(f){var a=Handlebars.compile(f);var c=$(''+g+'');for(var d in b){var e=a(b[d]);c.append(e);}h!='y'&&($('.num').text(b.length),T(),U());};var e=function(){W();};var f=function(){c=='lst3'&&setTimeout(function(){var a=$('.regular'),c=$('.bx_recommend .all_page'),d=$('.slide_pagination .btn_prev'),e=$('.slide_pagination .btn_next'),b=$('.auto_slide'),f=$('.bx_banner .all_page');a.on('init reInit afterChange',function(e,d,a,f){var b=a?a+1:1;c.html('<span class="now">'+b+'</span>'+' / '+d.slideCount);}),a.slick({infinite:!0,arrows:!0,dot:!1,slidesToShow:1,slidesToScroll:1,prevArrow:d,nextArrow:e}),b.on('init reInit afterChange',function(d,c,a,e){var b=a?a+1:1;f.html(b+'/'+c.slideCount);}),b.slick({infinite:!0,arrows:!1,dot:!1,autoplay:!0,autoplaySpeed:4000,pauseOnHover:!0,pauseOnFocus:!0,slidesToShow:1,slidesToScroll:1});});};a.then(d),a.then(e),a.then(f);};var W=function(){$('.lst_item_type2, .lst_item_type3').on('mouseenter',function(){var a=Number($(this).find('.xPos').attr('value'));var b=Number($(this).find('.yPos').attr('value'));a2(new daum.maps.LatLng(b,a));}),$('.lst_item_type2, .lst_item_type3').on('mouseleave',function(){I(null);});};$.get('js/data/estateInfo_recomm.json',function(a){F=a,$.map(F,function(a,b){$.map(a,function(a,b){b=='danji_seq'?Q.push(a):'';});}),g(a,'lst2','.regular.slick-slider','y'),g(a,'lst3','.auto_slide.slick-slider','y');}),$.get('js/data/estateInfo.json',function(b){i=b,g(b,'lst','.bx_lst_item_type2'),$('.btn_reset').click(function(){$('.bx_lst_item_type2').empty(),g(b,'lst','.bx_lst_item_type2');});var a=$(i).map(function(b,a){return new daum.maps.Marker({position:new daum.maps.LatLng(a.ypos,a.xpos)});});$.map(i,function(a,b){$.map(a,function(a,b){b=='danji_seq'?l.push(a):'',b=='danji_name'?y.push(a):'',b=='memul_class'?p.push(a):'';});});var c=[];$(b).map(function(d){a[d].Ta=l[d],y[d]!=''?a[d].va=y[d]:a[d].va=p[d],daum.maps.event.addListener(a[d],'click',function(){c=[],$('.bx_lst_item_type2').empty(),$.map(a[d],function(d,e){if(e=='Ta')for(var a in l)d==l[a]&&c.push(b[a]);if(e=='va')for(var a in p)d==p[a]&&c.push(b[a]);}),g(c,'lst','.bx_lst_item_type2');}),daum.maps.event.addListener(a[d],'mouseover',function(){});}),e.addMarkers(a);}),daum.maps.event.addListener(e,'clusterclick',function(b){$('.bx_lst_item_type2').empty();var c=[];$.map(b._markers,function(a,b){$.map(a,function(a,b){b=='Ta'&&c.push(a);});}),c=c.reduce(function(a,b){return a.indexOf(b)<0&&a.push(b),a;},[]);var d=[];for(var f in c)$.map(i,function(a,b){$.map(a,function(a,e){e=='danji_seq'&&a==c[f]&&d.push(i[b]);});});if(g(d,'lst','.bx_lst_item_type2'),$('.map_info').find('.on').removeClass('on'),a.getLevel()<=3){$.map(e._clusters,function(a,b){$.map(a,function(a,b){b=='_content'&&a.innerHTML.length>2&&(a.innerHTML=a.innerHTML.replace(/.*>/g,''));});});var h=b._content.style.width;switch(h){case n:b._content.className='wh on';break;case k:b._content.className='wh2 on';break;case r:b._content.className='wh3 on';break;case q:b._content.className='wh4 on';break;}b._content.innerHTML=b.getMarkers()[0].va+'<br>'+b.getMarkers().length;}else daum.maps.event.addListener(e,'clusterover',function(a){a._content.innerHTML=a.getMarkers().length,a._content.className='';});}),daum.maps.event.addListener(a,'dragend',function(){a.getLevel()<=3&&$.map(e._clusters,function(a,b){$.map(a,function(a,b){b=='_content'&&a.innerHTML.length>2&&(a.innerHTML=a.innerHTML.replace(/.*>/g,''),a.className='');});});});var C=function(){a.getLevel()<=3?(daum.maps.event.addListener(e,'clusterover',function(a){var b=a._content.style.width;switch(b){case n:a._content.className==''||a._content.className=='wh'?a._content.className='wh':a._content.className='wh on';break;case k:a._content.className==''||a._content.className=='wh2'?a._content.className='wh2':a._content.className='wh2 on';break;case r:a._content.className==''||a._content.className=='wh3'?a._content.className='wh3':a._content.className='wh3 on';break;case q:a._content.className==''||a._content.className=='wh4'?a._content.className='wh4':a._content.className='wh4 on';break;}a._content.innerHTML=a.getMarkers()[0].va+'<br>'+a.getMarkers().length;}),daum.maps.event.addListener(e,'clusterout',function(a){a._content.innerHTML=a.getMarkers().length;switch(a._content.className){case'wh on':a._content.className='wh on';a._content.innerHTML=a.getMarkers()[0].va+'<br>'+a.getMarkers().length;break;case'wh2 on':a._content.className='wh2 on';a._content.innerHTML=a.getMarkers()[0].va+'<br>'+a.getMarkers().length;break;case'wh3 on':a._content.className='wh3 on';a._content.innerHTML=a.getMarkers()[0].va+'<br>'+a.getMarkers().length;break;case'wh4 on':a._content.className='wh4 on';a._content.innerHTML=a.getMarkers()[0].va+'<br>'+a.getMarkers().length;break;default:a._content.className='';}})):daum.maps.event.addListener(e,'clusterover',function(a){a._content.innerHTML=a.getMarkers().length,a._content.className='';});};C(),daum.maps.event.addListener(a,'zoom_changed',function(){C();});var Y=function(){var b=function(){navigator.geolocation.getCurrentPosition(function(a){var b=a.coords.latitude,c=a.coords.longitude;var d=new daum.maps.LatLng(b,c),e='<div style="padding:5px;">여기에 계신가요?!</div>';displayMarker(d,e);}),J(locPosition),a.setCenter(locPosition),a.setLevel(4);};var c=function(c){var d=c.coords.latitude,e=c.coords.longitude;var b=new daum.maps.LatLng(d,e);J(b),a.setCenter(b),a.setLevel(4),$('.loader').removeClass('on'),$('.user.icon').show();};var d=function(a){$('.loader').removeClass('on'),$('.user.icon').show();switch(a.code){case a.TIMEOUT:console.log('Browser geolocation error !\n\nTimeout.');break;case a.PERMISSION_DENIED:a.message.indexOf('Only secure origins are allowed')==0&&b();break;case a.POSITION_UNAVAILABLE:console.log('Browser geolocation error !\n\nPosition unavailable.');break;}};var e=function(){navigator.geolocation&&(watchID=navigator.geolocation.watchPosition(c,d,{maximumAge:50000,timeout:20000,enableHighAccuracy:!0}));};e();};var D;$('.btn_zoomin').click(function(){ac();}),$('.btn_zoomout').click(function(){ab();}),$('.btn_airline').click(function(){$(this).toggleClass('on'),$(this).hasClass('on')?(a1('skyview'),$('.btn_loadview').hasClass('on')&&H(!0)):a1('roadmap');});var m=!1,w=document.getElementById('mapCtrl'),a8=document.getElementById('mapWrapper'),a7=document.getElementById('map'),a3=document.getElementById('roadview');var t=new daum.maps.Roadview(a3);var a5=new daum.maps.RoadviewClient();daum.maps.event.addListener(t,'position_changed',function(){var b=t.getPosition();a.setCenter(b),m&&c.setPosition(b);});var a6=new daum.maps.MarkerImage('http://t1.daumcdn.net/localimg/localimages/07/mapapidoc/roadview_wk.png',new daum.maps.Size(35,39),{offset:new daum.maps.Point(14,39)});var c=new daum.maps.Marker({image:a6,position:a.getCenter(),draggable:!0});daum.maps.event.addListener(c,'dragend',function(b){var a=c.getPosition();L(a);}),daum.maps.event.addListener(a,'click',function(d){if($('.btn_loadview').hasClass('on')&&c.setMap(a),!m)return;var b=d.latLng;c.setPosition(b),L(b);}),$('#roadviewControl').click(function(){$('.btn_distance').hasClass('on')||(console.log($('.btn_distance').attr('class')),aa());}),$('.btn_focus').click(function(){$(this).toggleClass('on'),$(this).hasClass('on')?Y():I(null);});var j=!1;var h;var d;var f;var b={};var o=[];var a4=function(){var c=function(f){var b=f.latLng;if(!j)j=!0,G(),E(),B(),d=new daum.maps.Polyline({map:a,path:[b],strokeWeight:3,strokeColor:'#db4040',strokeOpacity:1,strokeStyle:'solid'}),h=new daum.maps.Polyline({strokeWeight:3,strokeColor:'#db4040',strokeOpacity:0.5,strokeStyle:'solid'}),Z(b,0);else{var c=d.getPath();c.push(b),d.setPath(c);var e=Math.round(d.getLength());Z(b,e);}};daum.maps.event.addListener(a,'click',c),o.push({target:a,type:'click',handler:c});var e=function(i){if(j){var b=i.latLng;var c=d.getPath();var e=[c[c.length-1],b];h.setPath(e),h.setMap(a);var f=Math.round(d.getLength()+h.getLength()),g='<div class="dotOverlay distanceInfo">총거리 <span class="number">'+f+'</span>m</div>';K(g,b);}};daum.maps.event.addListener(a,'mousemove',e),o.push({target:a,type:'mousemove',handler:e});var f=function(f){if(j){h.setMap(null),h=null;var a=d.getPath();if(a.length>1){b[b.length-1].distance&&(b[b.length-1].distance.setMap(null),b[b.length-1].distance=null);var c=Math.round(d.getLength()),e=a9(c);K(e,a[a.length-1]);}else G(),B(),E();j=!1;}};daum.maps.event.addListener(a,'rightclick',f),o.push({target:a,type:'rightclick',handler:f});};$('.btn_distance').click(function(){$(this).toggleClass('on'),$(this).hasClass('on')&&!$('.btn_loadview').hasClass('on')?a4():($(this).removeClass('on'),G(),B(),E(),o.forEach(function(a){daum.maps.event.removeListener(a.target,a.type,a.handler);}));});});